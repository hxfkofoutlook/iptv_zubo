name: IPTVæºè‡ªåŠ¨æ£€æµ‹ä¸æ›´æ–°

on:
  schedule:
    - cron: '0 2 * * *'
  workflow_dispatch:
  push:
    branches: [main]
    paths:
      - 'scripts/iptv_checker.py'
      - '.github/workflows/iptv-check.yml'

jobs:
  check-iptv:
    runs-on: ubuntu-latest
    
    # æ·»åŠ æƒé™è®¾ç½®
    permissions:
      contents: write  # æˆäºˆå†™å…¥æƒé™
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v3
      with:
        # ä½¿ç”¨ GitHub Tokenï¼ˆé»˜è®¤å·²æä¾›ï¼‰
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: è®¾ç½®Pythonç¯å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: å®‰è£…ä¾èµ–
      run: pip install requests
    
    - name: è¿è¡ŒIPTVæ£€æµ‹è„šæœ¬
      run: python scripts/iptv_checker.py
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    
    - name: æ£€æŸ¥å¹¶æäº¤æ›´æ–°
      run: |
        if [[ -n $(git status --porcelain iptv.json) ]]; then
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions@github.com"
          git add iptv.json
          git commit -m "ğŸ¤– è‡ªåŠ¨æ›´æ–°IPTVæº $(date +'%Y-%m-%d %H:%M:%S')"
          git push
          echo "âœ… iptv.jsonå·²æ›´æ–°å¹¶æäº¤"
        else
          echo "ğŸ“­ iptv.jsonæ— å˜åŒ–ï¼Œæ— éœ€æäº¤"
        fi
